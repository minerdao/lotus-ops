# Filecoin最新挖矿集群硬件配置

## 1. 机器配置总览
FilGuard团队基于AMD7542 CPU 和 3080/3090显卡，测试出一套性价比高、密封速度快、简单实用的挖矿集群硬件配置，该方案有如下特点：
- PreCommit(P1, P2, C1)、Commit(C2)分别由单独的2台Worker完成；
- 可根据机器的具体配置，自由灵活的搭配两种机器的比例；
- 搭配FilGuard团队优化后的软件程序，可达到平均每台机器**每天3.2T**的封装速度；
- 搭配FilGuard团队的分布式Miner程序，可解决Miner单点风险、及显卡冲突等问题；

#### 1.1 Daemon推荐配置
|产品名称|型号|数量|备注|
|------|-----------------------|:-----:|---------|
| 主板 | 超微 H11SSL-i | 1 ||
| CPU | AMD 宵龙 EPYC 7402 | 1 ||
| 散热器 | AMD SP3-2U 纯铜 | 1 ||
| 内存 | 三星 DDR4-2933 ECC REG 64GB| 4 ||
| 网卡 | 万兆网卡单口 + 光模块| 2 ||
| 系统盘 | 三星 512GB NVME SSD | 1 ||
| 缓存盘 | 三星 U.2 2T SSD RAID0 | 4 ||
| 转接卡 | PCIe转U.2转接卡4盘位 |1||
| 机箱 | 2U机箱 + 暴力风扇 | 1 ||
| 电源 | 长城 1300W (1+1) | 1 ||

#### 1.2 Seal-Miner配置
|产品名称|型号|数量|备注|
|------|-----------------------|:-----:|---------|
| 主板 | 超微 H11SSL-i | 1 ||
| CPU | AMD 宵龙 EPYC 7402  | 1 ||
| 散热器 | AMD SP3-2U 纯铜  | 1 ||
| 内存 | 三星 DDR4-2933 ECC REG 64GB | 4 ||
| 系统盘 | 三星 512GB NVME SSD  | 1 ||
| 网卡 | 100G网卡  单卡单口 | 2 ||
| 光模块 | 100G多模光模块 | 2 ||
| 机箱 | 2U机箱 + 暴力风扇  | 1 ||
| 电源 | 长城 1300W (1+1)  | 1 ||

#### 1.3 PoSt-Miner配置
|产品名称|型号|数量|备注|
|------|-----------------------|:-----:|---------|
| 主板 | 技嘉 MZ32-ARO | 1 ||
| CPU | AMD 宵龙 EPYC 7402 | 1 ||
| 散热器 | AMD SP3-2U 纯铜 | 1 ||
| 内存 | 三星 DDR4-2933 ECC REG 64GB | 4 ||
| 显卡| MSI 3080 / MSI 3090 (涡轮)  | 2 ||
| 网卡 | 100G网卡  单卡单口 | 2 ||
| 光模块 | 100G多模光模块 | 2 ||
| 系统盘 | 三星 512GB NVME SSD | 1 ||
| 机箱 | 4U机箱 + 暴力风扇 | 1 ||
| 电源 | 长城1600W (1+1) | 2 ||

#### 1.4 PreCommit Worker配置
|产品名称|型号|数量|备注|
|------|-----------------------|:-----:|---------|
| 主板 | 技嘉 MZ32-ARO  | 1 ||
| CPU | AMD 宵龙 EPYC 7542 | 1 ||
| 散热器 | AMD SP3-2U 纯铜 | 1 ||
| 内存 | 三星 DDR4-2933 ECC REG 64GB | 16 ||
| 显卡| MSI 2080Ti (涡轮) | 1 ||
| 网卡 | X520-SR2 万兆网卡 含万兆模块 | 2 ||
| 系统盘 | 三星 256GB NVME SSD | 1 ||
| 缓存盘 | 三星 U.2 2T SSD RAID0 | 8 ||
| 转接卡 | PCIe转U.2转接卡4盘位 | 2 ||
| 机箱 | 4U机箱 + 暴力风扇 | 1 ||
| 电源 | 长城 1600W (1+1) | 1 ||

#### 1.5 Commit Worker配置
|产品名称|型号|数量|备注|
|------|-----------------------|:-----:|---------|
| 主板 | 超微 H11SSL-i | 1 ||
| CPU | AMD 宵龙 EPYC 7402 | 1 ||
| 散热器 | AMD SP3-2U 纯铜 | 1 ||
| 内存 | 三星 DDR4-2933 ECC REG 64GB | 8 ||
| 显卡 | MSI 3080 / MSI 3090 (涡轮) | 3 ||
| 网卡 | X520-SR2 万兆网卡 含万兆模块 | 2 ||
| 系统盘 | 三星 512GB NVME SSD | 1 ||
| 机箱 | 4U机箱 + 暴力风扇 | 1 ||
| 电源 | 长城 1600W | 2 ||

## 2. 小集群配置方案
这里的小集群，是指单节点总算力小于5PB，日封装50TB左右的挖矿集群。
### 2.1 小集群架构
无论是小集群、还是中大规模的集群，在网络上都要做到计算集群和存储集群的分离，实现网络隔离。小架构如下图所示（点击在新窗口中查看大图）：

![small-cluster-architecture](https://user-images.githubusercontent.com/1715211/110322443-17cc4700-804e-11eb-9714-ae18fa4613cf.png)

整个集群划分为管理集群、封装Miner集群、计算集群、存储集群、证明Miner集群，各个子集群作用如下：
- 管理集群：跳板机和管理机，可以用一台机器，也可以分开，跳板机上要做好安全策略和登录白名单，最好使用硬件进行登录认证。
- 封装Miner集群：包含接单的Miner、密封的Miner以及Daemon，用于管理计算节点，给计算Worker派发任务，完成密封结果数据的落盘。
- 计算集群：包含PreCommit Worker和Commit Worker，完成密封计算过程。
- 存储集群：NFS、ZFS、Ceph或其他商业存储、分布式存储集群。
- 证明Miner集群：时空证明机和爆块机，还包含一台时空证明和爆块的备用机。

### 2.2 Worker配比说明
按照以上机器配置，Worker机器配比如下：
|PreCommit Worker显卡|Commit Worker显卡|比例|备注|
|------|-----------------------|:-----:|---------|
| NVIDIA 3080 * 1 | NVIDIA 3080 * 2 | 3 : 2 ||
| NVIDIA 3080 * 1 | NVIDIA 3080 * 3 | 2 : 1 ||
| NVIDIA 3080 * 1 | NVIDIA 3090 * 2 | 2 : 1 ||

## 3. 中大集群配置方案
针对单节点总算力5PB以上，日封装超过100TB的中、大型集群，集群架构如下图所示（点击在新窗口中查看大图）：

![medium-cluster-architecture](https://user-images.githubusercontent.com/1715211/110322470-23b80900-804e-11eb-86fc-2231f134278a.png)


未完待续......